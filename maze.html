<!DOCTYPE html>
<html>
<header>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
    <style>
        html,
        body {

            margin: 0px;
            border: 0px;
            padding: 0px;
        }

        #gl-canvas {
            position: fixed;
            padding: 0px;
            top: 0px;
            left: 0px;
            border: 0px;
            margin: 0px;
            z-index: -1;
        }

        /* Maze Menu   */
        #maze_menu {
            display: block;
            position: absolute;
            right: 0px;
            height: 100%;
            width: 250px;
            z-index: 1;
            background-color: rgb(0, 0, 0, .3);
            margin: 0;
            padding: 0;

            text-align: center;
            color: rgb(255, 255, 255, 255);


        }

        .menu_button {
            margin: 5px;


            height: 30px;
            width: 180px;
        }

        .menu_select {
            margin: 5px;
            height: 20px;
            width: 180px;

        }

        .catagory {
            border: 3px solid white;
            align-items: center;
            align-content: center;
            text-align: center;
        }

        .number_input {
            width: 4em;
            margin: 15px;

            bottom: 0;
        }

        .option {
            width: auto;
            display: flex;
            flex-direction: row;
            justify-content: center;

            padding: 0;
        }

        h2 {
            margin: 0;
            padding: 0;
        }

        #change_maze {
            display: none;
        }

        #resume {
            display: none;
        }
    </style>
    <!-- Shader für die Skybox (Himmel)  -->
    <script id="vertex-shader-1" type="x-shader/x-vertex">
        attribute vec4 aposition;
        varying vec4 vposition;
        void  main(){
            vposition = aposition;
            gl_Position = aposition;
            gl_Position.z = 1.0;

        }
    </script>
    <script id="fragment-shader-1" type="x-shader/x-fragment">
        precision mediump float;
        uniform samplerCube skybox;
        uniform mat4 inverseprojection;
        varying vec4 vposition;
        void main(){
            vec4 dir_vec = normalize(inverseprojection * vposition);
            gl_FragColor = textureCube(skybox,dir_vec.xyz/dir_vec.w);
        }
        
    </script>
    <!-- Shader für die Objekte (Walls, Floor)  -->
    <script id="vertex-shader-0" type="x-shader/x-vertex">
    attribute vec4 aposition;
    attribute vec2 atextcoord;
    attribute vec3 anormal;
    uniform mat4 umatrix;
    uniform vec3 camera_pos;
    varying vec2 vtextcoord;
    varying vec3 vnormal;
    varying vec3 vsurfaceToView;
    void main(){
    gl_Position = umatrix * aposition;
    vtextcoord = atextcoord;
    vnormal = anormal;
    vsurfaceToView = camera_pos - aposition.xyz;

    }

    </script>
    <script id="fragment-shader-0" type="x-shader/x-fragment">
        precision mediump float;
        varying vec2 vtextcoord;
        varying vec3 vnormal;
        varying vec3 vsurfaceToView;
        uniform sampler2D utexture;
        uniform vec3 ureverse_light_dir;
        uniform int wall_flag;
        uniform float udiffuse;
        uniform float uspecular;
        uniform float ushine;

        // Fog parameter
        uniform float uFogDensity;
        uniform vec3 fogColor; 
        uniform vec3 ufogDist;

        void main(){
            vec3 normal = normalize(vnormal);
            float difuse_light = udiffuse*max(dot(normal,ureverse_light_dir),0.0);

            gl_FragColor = texture2D( utexture , vtextcoord );
            gl_FragColor.rgb*= difuse_light + 1.0 - udiffuse;

            if(wall_flag == 1){
            vec3 surfaceToView = normalize(vsurfaceToView);
            vec3 halfVector = normalize(ureverse_light_dir + surfaceToView);
            float specular_light = pow(max(dot(normal, halfVector),0.0),ushine);
            gl_FragColor.rgb+= uspecular*specular_light;
        }
        
        float fogFactor = smoothstep(0.0, 1.0, 1.0) - exp(-uFogDensity * length(vsurfaceToView));
        gl_FragColor.rgb = mix(gl_FragColor.rgb, fogColor, fogFactor);
        
        float fogStart = ufogDist.x;
        float fogEnd = ufogDist.y;
        float fogFactorDist = (length(vsurfaceToView - ureverse_light_dir) - fogStart) / (fogEnd - fogStart);
        fogFactorDist = clamp(fogFactorDist, 0.0, 1.0);
        
        float fogWeight = 0.01; 
        gl_FragColor.rgb = mix(gl_FragColor.rgb, fogColor, mix(fogFactor, fogFactorDist, fogWeight));
        

        }
    </script>

    <script id="vertex-shadow-shader" type="x-shader/x-vertex">
        precision highp float;
        
        layout (location = 0) in vec3 a_pos;
        layout (location = 1) in mat4 a_modelMatrix;

        uniform mat4 u_lightXform;
        uniform mat4 u_lightProjection;

        out vec3 FragPos;

        void main()
        {
            FragPos = (a_modelMatrix * vec4(a_pos, 1.0)).xyz;
            gl_Position = u_lightProjection * u_lightXform * a_modelMatrix * vec4(a_pos, 1.0);
        }
    </script>
    <script id="fragment-shadow-shader" type="x-shader/x-fragment">
        precision mediump float;

        uniform highp mat4 u_lightXform;
    
        in vec3 FragPos;
    
        const float farPlane = ${lightFarPlane.toFixed(2)};
    
        void main() {
            // get distance between fragment and light source
            float lightDistance = length(FragPos - vec3(vec4(0.0, 0.0, -1.0, 1.0) * u_lightXform));
    
            // map to [0;1] range by dividing by far_plane
            lightDistance = lightDistance / farPlane;
    
            // write this as modified depth
            gl_FragDepth = lightDistance;
        }
    </script>

    <script type="text/javascript" src="Common/webgl-utils.js"></script>
    <script type="text/javascript" src="Common/initShaders.js"></script>
    <script type="text/javascript" src="Common/MV.js"></script>
    <script type="module" src="maze.js" ></script>
</header>

<body>
    <!-- Maze Menu UI  -->
    <div id="maze_menu">
        <!-- Maze Menu Überschrift  -->
        <div class="catagory">
            <h1><b>Maze Menu</b></h1>
        </div>
        <!-- maze Menu Licht  -->
        <div class="catagory">
            <h2>Lichteinflüsse</h2>
            <div class="option">
                <p>Diffuse </p>
                <input type="range" min="0" max="1" value=".5" step=".0001" id="diffuse"></input>
            </div>
            <div class="option">
                <p>Specular </p>
                <input type="range" min="0" max="1" value=".2" step=".0001" id="specular"></input>
            </div>
            <div class="option">
                <p>Shine</p>
                <input type="range" min="10" max="500" value="30" id="shine"></input>
            </div>
            <div class="option">
                <p>Fog </p>
                <input type="range" min="0.1" max="1" value="3" step=".01" id="fog"></input>
            </div>
        </div>
        <!-- Maze Menu Texturen  -->
        <div class="catagory">
            <h2>Textures</h2>
            <select id="platform_texture" class="menu_select">
                <option value="0">Plattform Textur</option>
                <option value="1">Heller Ziegelstein</option>
                <option value="2">Dunkler Ziegelstein</option>
                <option value="3">Pflaster</option>
                <option value="4">Beton</option>
                <option value="5">Helle Stein Wand</option>
                <option value="6">Rote Stein Wand</option>
                <option value="7">Steinboden</option>
                <option value="8">Metal1</option>
                <option value="9">Metal2</option>
                <option value="10">Nelke</option>
                <option value="11">Gras</option>
                <option value="12">Mansion Texture</option>
            </select>
            <select id="wall_texture" class="menu_select">
                <option value="0">Wand Textur</option>
                <option value="1">Heller Ziegelstein</option>
                <option value="2">Dunkler Ziegelstein</option>
                <option value="3">Pflaster</option>
                <option value="4">Beton</option>
                <option value="5">Helle Stein Wand</option>
                <option value="6">Rote Stein Wand</option>
                <option value="7">Steinboden</option>
                <option value="8">Metal1</option>
                <option value="9">Metal2</option>
                <option value="10">Nelke</option>
                <option value="11">Gras</option>
                <option value="12">Mansion Texture</option>

            </select>
        </div>
        <!-- Maze Menu Optionen zum Generieren des Maze's  -->
        <div class="catagory" id="maze_parameters">
            <h2>Maze Optionen</h2>
            <div class="option">
                <p>Zellengröße</p>
                <input type="number" class="number_input" id="cell_size" value="2" step=".1" min="1">
            </div>
            <div class="option">
                <p>Wandgröße</p>
                <input type="number" class="number_input" id="wall_height" value="3" step=".1" min="0.0">
            </div>
            <div class="option">
                <p>Wandbreite</p>
                <input type="number" class="number_input" id="wall_width" value=".5" step=".1" min="0.0">
            </div>
            <div class="option">
                <!-- TODO: Max hinzufügen ?  -->
                <input type="number" class="number_input" id="rows" value="20" step="1" min="4">
                <p><b>X</b></p>
                <input type="number" class="number_input" id="columns" value="20" step="1" min="4">
            </div>
            <button id="GM" class="menu_button"><b>Generiere Maze</b></button>
        </div>
        <!-- Maze Menu Spieler  -->
        <div class="catagory">
            <h2>Spieler</h2>
            <div class="option">
                <p>Größe</p>
                <input type="number" class="number_input" id="pheight" value="1" step=".1" min=".1">
            </div>
            <div class="option">
                <p>Max. Geschwindikeit</p><input type="number" class="number_input" id="velocity" value="8" step=".1"
                    min="0">
            </div>
            <div class="option">
                <p>Beschleunigung</p><input type="number" class="number_input" id="acceleration" value=".05" step=".001"
                    min=".01">
            </div>
            <div class="option">
                <p>Sensitivität </p>
                <input type="range" min="0.0" max="3.0" value=".4" step=".01" id="sensativity"></input>
            </div>
            <button id="start_game" class="menu_button"><b>Start Game</b></button>
            <button id="change_maze" class="menu_button"><b>Maze verändern</b></button>
            <button id="resume" class="menu_button"><b>Weiterspielen</b></button>
        </div>
        <div class="catagory">
            <p>Steuerung: w, a, s, d, p, maus</p>
        </div>
    </div>
    <canvas id="gl-canvas" height="100%" width="100%"></canvas>
</body>


</html>